function removeWrapper(t){$(t).css("display","none"),$(t).html("")}function masterfileClientSideValidation(){var t="<ul>",e=!1,a=$("#columnsFieldName").val().split("|"),i=0,o=!0;return $("form#form_masterfile_dynamic .masterfiletransaction-fields").each(function(){"9"!=$(this).attr("data-type")&&"8"!=$(this).attr("data-type")&&"7"!=$(this).attr("data-type")&&"10"!=$(this).attr("data-type")&&"6"!=$(this).attr("data-type")&&"1"==$(this).attr("data-required")&&""==$(this).val()?(t=t+"<li>"+a[i]+" must not be blank.</li>",e=!0):"6"==$(this).attr("data-type")?(textEditorID=$(this).attr("id"),textEditorContent=encodeURIComponent(CKEDITOR.instances[textEditorID].getData()),""==textEditorContent&&(t=t+"<li>"+a[i]+" must not be blank.</li>",e=!0)):"7"!=$(this).attr("data-type")&&"10"!=$(this).attr("data-type")||"1"!=$(this).attr("data-required")||""!=$(this).val()?"8"==$(this).attr("data-type")&&"1"==$(this).attr("data-required")?(o=!0,$(this).find("input[type=radio]").each(function(t,e){1==$(this).prop("checked")&&(o=!1)}),1==o&&(t=t+"<li> Please choose a/n "+a[i]+"</li>",e=!0)):"9"==$(this).attr("data-type")&&"1"==$(this).attr("data-required")&&(o=!0,$(this).find("input[type=checkbox]").each(function(t,e){1==$(this).prop("checked")&&(o=!1)}),1==o&&(t=t+"<li> Please choose at least one "+a[i]+"</li>",e=!0)):(t=t+"<li> Please select a/n "+a[i]+"</li>",e=!0),i++}),t+="</ul>",1==e?($("#modal_error_container_content").html(t),$("#modal_error_container").slideDown("fast"),$("#save_modal_action").button("reset"),!1):!0}function masterfileServerSideValidation(t,e){var a;$("form#form_masterfile_dynamic .masterfiletransaction-fields").each(function(){"6"==$(this).attr("data-type")&&(a=$(this).attr("id"),$(this).val(encodeURIComponent(CKEDITOR.instances[a].getData())))}),serializedData=$("form#form_masterfile_dynamic").serialize(),$.ajax({url:e,type:"post",data:serializedData,beforeSend:function(t,e){}}).done(function(e,a,i){var o=!1,n="";if("success"==a||"notmodified"==a)if(null==e)n="<ul><li>Fatal Error. There is no response returned. Please try again.</li></ul>",o=!0;else if("1"==e[0].result)""==CUSTOM_VALIDATION||t?masterfileSaveFunction():masterfileServerSideValidation(!0,ABSOLUTE_PATH+""+CUSTOM_VALIDATION);else{n="";for(var r=0;r<e.length;r++)n=n+"<li>"+e[r].error_message+"</li>",o=!0;n="<ul>"+n+"</ul>"}else"abort"==a?(n="<ul><li>Validation Request Aborted.</li></ul>",o=!0):"error"==a||"parsererror"==a?(n="<ul><li>Fatal error detected upon validation request. Please try again.</li></ul>",o=!0):"timeout"==a&&(n="<ul><li>Validation request has timed out. Please try again.</li></ul>",o=!0);1==o&&($("#modal_error_container_content").html(n),$("#modal_error_container").slideDown("fast"),$("#blocker").fadeOut("fast"),$("#save_modal_action").button("reset"))}).fail(function(t,e,a){$("#modal_error_container_content").html("<ul><li>Could not connect to the server or file not found.</li></ul>"),$("#modal_error_container").slideDown("fast"),$("#blocker").fadeOut("fast"),$("#save_modal_action").button("reset")})}function masterfileSaveFunction(){var t,e,a="&";$(".masterfiletransaction-fields").each(function(i,o){"6"==$(this).attr("data-type")&&(e=$(this).attr("id"),t=CKEDITOR.instances[e].getData(),a=a+$(this).attr("name")+"="+encodeURIComponent(t))}),$.ajax({url:ABSOLUTE_PATH+(""!=CUSTOM_SAVE?CUSTOM_SAVE:"api/SaveMasterfiles.php"),type:"post",data:$("form#form_masterfile_dynamic").serialize()+a,beforeSend:function(t,e){}}).done(function(t,e,a){var i=!1,o="";if("success"==e||"notmodified"==e)if(null==t||t.length<=0)o="<ul><li>Fatal Error. There is no response returned. Please try again.</li></ul>",i=!0;else if("1"==t[0].result){$("#outer_success_message").html(t[0].error_message);var n=""!=t[0].last_code?t[0].last_code:"";""!=CUSTOM_AFTERSAVE?masterfileCustomAfterSaveFunction(n):reShowBlocker()}else{o="";for(var r=0;r<t.length;r++)o=o+"<li>"+t[r].error_message+"</li>",i=!0;o="<ul>"+o+"</ul>"}else"abort"==e?(o="<ul><li>Save Request Aborted.</li></ul>",i=!0):"error"==e||"parsererror"==e?(o="<ul><li>Fatal error detected upon save request. Please try again.</li></ul>",i=!0):"timeout"==e&&(o="<ul><li>Save request has timed out. Please try again.</li></ul>",i=!0);1==i&&($("#modal_error_container_content").html(o),$("#modal_error_container").slideDown("fast"),$("#blocker").fadeOut("fast"),$("#save_modal_action").button("reset"))}).fail(function(t,e,a){$("#modal_error_container_content").html("<ul><li>Could not connect to the server or file not found.</li></ul>"),$("#modal_error_container").slideDown("fast"),$("#blocker").fadeOut("fast"),$("#save_modal_action").button("reset")})}function reShowBlocker(){$("#blocker").fadeOut("fast",function(){$("#MasterfileAddEditModal").modal("hide");var t=$.fn.dataTable.tables(!0);$(t).DataTable().ajax.reload(null,!1),$("#outer_success_container").slideDown("fast",function(){setTimeout(function(){$("#outer_success_container").slideUp("fast")},5e3)})})}function masterfileCustomAfterSaveFunction(t){$.ajax({url:ABSOLUTE_PATH+CUSTOM_AFTERSAVE,type:"post",data:$("form#form_masterfile_dynamic").serialize()+"&last_code="+t,beforeSend:function(t,e){}}).done(function(t,e,a){reShowBlocker()}).fail(function(t,e,a){reShowBlocker()})}function masterfileBeforeDeleteFunction(t,e,a,i,o,n,r,l){$.ajax({url:ABSOLUTE_PATH+CUSTOM_AFTERSAVE,type:"post",data:"last_code="+t+"&transactionmode="+e+"&dbconnect="+a+"&tableName="+i+"&primarycodefields="+o+"&modulemstcode="+n+"&menuitemmstcode="+r+"&valueviewed="+l,beforeSend:function(t,e){}}).done(function(s,d,c){masterfileDeleteFunction(t,e,a,i,o,n,r,l)}).fail(function(s,d,c){masterfileDeleteFunction(t,e,a,i,o,n,r,l)})}function masterfileDeleteFunction(t,e,a,i,o,n,r,l){$.ajax({url:ABSOLUTE_PATH+"api/SaveMasterfiles.php",type:"post",data:"primarycodevalue="+t+"&transactionmode="+e+"&dbconnect="+a+"&tableName="+i+"&primarycodefields="+o+"&modulemstcode="+n+"&menuitemmstcode="+r+"&valueviewed="+l,beforeSend:function(t,e){}}).done(function(t,e,a){var i=!1,o="";if("success"==e||"notmodified"==e)if(null==t)o="<ul><li>Fatal Error. There is no response returned. Please try again.</li></ul>",i=!0;else if("1"==t[0].result){$("#outer_success_message").html(t[0].error_message);var n=$.fn.dataTable.tables(!0);$(n).DataTable().ajax.reload(null,!1),$("#blocker").fadeOut("fast",function(){$("#outer_success_container").slideDown("fast",function(){setTimeout(function(){$("#outer_success_container").slideUp("fast")},5e3)})})}else{o="";for(var r=0;r<t.length;r++)o=o+"<li>"+t[r].error_message+"</li>",i=!0;o="<ul>"+o+"</ul>"}else"abort"==e?(o="<ul><li>Delete Request Aborted.</li></ul>",i=!0):"error"==e||"parsererror"==e?(o="<ul><li>Fatal error detected upon delete request. Please try again.</li></ul>",i=!0):"timeout"==e&&(o="<ul><li>Delete request has timed out. Please try again.</li></ul>",i=!0);1==i&&($("#outer_error_container_content").html(o),$("#outer_error_container").slideDown("fast",function(){setTimeout(function(){$("#outer_error_container").slideUp("fast")},1e4)}),$("#blocker").fadeOut("fast"))}).fail(function(t,e,a){$("#outer_error_container_content").html("<ul><li>Could not connect to the server or file not found.</li></ul>"),$("#outer_error_container").slideDown("fast",function(){setTimeout(function(){$("#outer_error_container").slideUp("fast")},1e4)}),$("#blocker").fadeOut("fast")})}$(document).ready(function(){$(".toggle_filter").live("click",function(){$(this).parents(".panel").find(".panel-body").slideToggle("fast"),$(this).parents(".panel").find(".panel-footer").slideToggle("fast"),$(this).find(".botton-icon-display").toggle()}),$(".per_record_action_cont").each(function(t,e){$(this).css("min-width","100px")}),$(".dialog_yes_action").live("click",function(){$(".dialog_yes_action").button("loading"),$(".dialog_no_action").button("loading"),$("#DialogModal").modal("hide"),"has_callback_function"==$(this).data("trans")&&"cancel"==$(this).data("mode")?cancelCallbackFunction("yes"):"has_callback_function"==$(this).data("trans")&&"save"==$(this).data("mode")?saveCallbackFunction("yes"):"custom_action"!=$(this).data("trans")&&"custom_action_whole"!=$(this).data("trans")||"save"!=$(this).data("mode")?"custom_action"!=$(this).data("trans")&&"custom_action_whole"!=$(this).data("trans")||"cancel"!=$(this).data("mode")?"can_add"!=$(this).data("trans")&&"can_edit"!=$(this).data("trans")||"cancel"!=$(this).data("mode")?"can_add"!=$(this).data("trans")&&"can_edit"!=$(this).data("trans")||"save"!=$(this).data("mode")?"can_delete"==$(this).data("trans")&&"delete"==$(this).data("mode")&&($("#loading-message").html("<b>Deleting...</b>"),$("#blocker").fadeIn("fast",function(){}),""!=CUSTOM_AFTERSAVE?masterfileBeforeDeleteFunction($(this).attr("data-primarycode"),$(this).attr("data-trans"),$(this).attr("data-dbconnect"),$(this).attr("data-tablename"),$(this).attr("data-primarycodefields"),$(this).attr("data-modulemstcode"),$(this).attr("data-menuitemmstcode"),$(this).attr("data-valueviewed")):masterfileDeleteFunction($(this).attr("data-primarycode"),$(this).attr("data-trans"),$(this).attr("data-dbconnect"),$(this).attr("data-tablename"),$(this).attr("data-primarycodefields"),$(this).attr("data-modulemstcode"),$(this).attr("data-menuitemmstcode"),$(this).attr("data-valueviewed"))):($("#loading-message").html("<b>Saving...</b>"),$("#save_modal_action").button("loading"),$("#blocker").fadeIn("fast",function(){masterfileServerSideValidation(!1,ABSOLUTE_PATH+"api/ValidateMasterfiles.php")})):$("#MasterfileAddEditModal").modal("hide"):($("#profile_pic_save").button("reset"),$("#"+$(this).data("modalid")).modal("hide"),$("#transfer_year_save").button("reset")):saveCallbackFunction("yes")}),$(".dialog_no_action").live("click",function(){$(".dialog_yes_action").button("loading"),$(".dialog_no_action").button("loading"),$("#DialogModal").modal("hide"),$("#save_modal_action").button("reset"),$("#profile_pic_save").button("reset"),$("#new_period_save").button("reset"),$("#close_period_save").button("reset"),$("#transfer_year_save").button("reset")}),$("#filter_button").live("click",function(){var t=$.fn.dataTable.tables(!0);$(t).DataTable().ajax.reload(null,!1)}),$("#clear_button").live("click",function(){$(".filter-fields").each(function(t,e){$(this).is(":checkbox")||$(this).is(":radio")?$(this).prop("checked",!1):$(this).val(""),$(this).change()});var t=$.fn.dataTable.tables(!0);$(t).DataTable().ajax.reload(null,!1)}),$(".close_modal_action").live("click",function(){$("#"+$(this).attr("data-id")).modal("hide")}),$(".modal").live("hidden.bs.modal",function(t){removeWrapper($(this).parent("div"))}),$(window).bind("load resize",function(){topOffset=200,height=window.innerHeight>0?window.innerHeight:screen.height,height-=topOffset,$(".modal").each(function(t,e){$(this).find(".modal-body:not(.dont-resize)").css("max-height",height+"px"),$(this).find(".modal-body.dont-resize").css("max-height","")})})});